<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore-compat.js"></script>
    <!-- cdn  firebase-app,firebase - firestore -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=chevron_right" />

    <!-- INTERNAL CSS -->
    <style>
        :root{
            --bg:#0f1724;
            --card:#0b1220;
            --muted:#9aa4b2;
            --accent:#7c3aed;
            --accent-2:#06b6d4;
            --white:#ffffff;
            --radius:12px;
            --gap:12px;
        }

        *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}

        body{
            margin:0;
            min-height:100vh;
            display:flex;
            align-items:center;
            justify-content:center;
            background:linear-gradient(180deg, #071025 0%, #091028 60%, #041019 100%);
            color:var(--white);
            padding:24px;
        }

        .chat-card{
            width:min(760px, 96%);
            background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border:1px solid rgba(255,255,255,0.04);
            border-radius:var(--radius);
            padding:18px;
            box-shadow: 0 8px 30px rgba(2,6,23,0.6);
        }

        .header{
            display:flex;
            align-items:center;
            gap:12px;
            margin-bottom:14px;
        }
        .logo{
            width:44px;
            height:44px;
            border-radius:10px;
            background:linear-gradient(135deg,var(--accent), var(--accent-2));
            display:flex;
            align-items:center;
            justify-content:center;
            font-weight:700;
            color:var(--white);
            font-size:16px;
        }
        .title{
            font-size:16px;
            font-weight:600;
            letter-spacing:0.2px;
        }
        .subtitle{
            font-size:12px;
            color:var(--muted);
        }

        .form-row{
            display:flex;
            gap:var(--gap);
            align-items:center;
            margin-top:6px;
        }

        input[type="text"]{
            flex:1;
            padding:10px 12px;
            border-radius:10px;
            border:1px solid rgba(255,255,255,0.06);
            background:rgba(255,255,255,0.02);
            color:var(--white);
            outline:none;
            font-size:14px;
        }

        input#usernameInput{
            width:180px;
            flex:0 0 180px;
        }

        button#sendMessageButton{
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding:10px 14px;
            border-radius:10px;
            border:none;
            cursor:pointer;
            background:linear-gradient(90deg,var(--accent), #5b21b6);
            color:var(--white);
            font-weight:600;
            font-size:14px;
            box-shadow: 0 6px 18px rgba(124,58,237,0.18);
        }

        button#sendMessageButton .material-symbols-outlined{
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            vertical-align:middle;
        }

        .hint{
            margin-top:12px;
            font-size:13px;
            color:var(--muted);
        }

        /* responsive tweaks */
        @media (max-width:520px){
            .form-row{flex-direction:column; align-items:stretch;}
            input#usernameInput{width:100%; flex:1;}
            button#sendMessageButton{width:100%; justify-content:center;}
        }
    </style>
</head>

<body>
    <div class="chat-card">
        <div class="header">
            <div class="logo">RBT</div>
            <div>
                <div class="title">Message Sender (Demo)</div>
                <!-- <div class="subtitle">Type a username and message, then click send</div> -->
            </div>
        </div>

        <div class="form-row">
            <!-- ADDED: username input required by the script -->
            <!-- <input type="text" id="usernameInput" name="username" placeholder="Your name (username)" value="" /> -->

            <input type="text" name="message" id="msg" placeholder="Type your message here" size="30" value="" />

            <button id="send-msg">Send
                <span class="material-symbols-outlined">chevron_right</span>
            </button>
        </div>

        <!-- <div class="hint">
            Note: This page uses Firebase Firestore SDK (compat). Make sure your Firebase rules allow writes from the client or you have auth set up.
        </div> -->
        <div id="chat" style="margin-top:20px; max-height:300px; overflow-y:auto; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px;">
            <h3>Chat Messages:</h3>
    </div>

    <script>
       const firebaseConfig = {
      apiKey: "AIzaSyAWYsGxluIZQ9KENK144-t5Szq0liWuBgc",
      authDomain: "auth-project-2a24b.firebaseapp.com",
      projectId: "auth-project-2a24b",
      storageBucket: "auth-project-2a24b.firebasestorage.app",
      messagingSenderId: "740016635928",
      appId: "1:740016635928:web:e32941a9ee8e6fca26436d"
    };


        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);




        //get button
        let bhejdo = document.getElementById("send-msg");
        //add event listener
        bhejdo.addEventListener("click", async () => {

            let message = document.getElementById("msg").value;


            // let msg=document.getElementById("messageInput").value;
            //we are adding try and catch
            try {

                console.log("send message function called");
                let result = await firebase.firestore().collection("messages").add({
                    message
                });
                if (result.exists) {
                    console.log(`Message sent successfully: ${result.data().message}`);
                }


            } catch (error) {
                console.error("Error sending message:", error);
            }
            document.getElementById("msg").value = "";

        });

function getMsg() {
    firebase.firestore()
        .collection("messages")
        .onSnapshot(snapshot => {
            snapshot.docChanges().forEach((change) => {
                if (change.type === "added") {
                    // Create elements
                    let pTag = document.createElement("p");
                    let editbuttonTag = document.createElement("button");
                    editbuttonTag.innerText = "Edit";

                    let deletebuttonTag = document.createElement("button");
                    deletebuttonTag.innerText = "Delete";
                    deletebuttonTag.setAttribute("id", "delete-" + change.doc.id);

                    console.log("New message: ", change.doc.data());
                    pTag.innerText = change.doc.data().message;

                    // Append to container
                    let chatContainer = document.getElementById("chat");
                    chatContainer.appendChild(pTag);
                    chatContainer.appendChild(editbuttonTag);
                    chatContainer.appendChild(deletebuttonTag);

                    // Delete button event
                    deletebuttonTag.addEventListener("click", () => {
                        deleteMsg(change.doc.id);
                    });
                } else if (change.type === "removed") {
                    console.log(`Message with ID ${change.doc.id} was removed`);
                    // Optional: remove it from DOM if needed
                }
            });
        });
}

// Call after page load
getMsg();

      async function deleteMsg(messageId) {
    try {
        await firebase.firestore().collection("messages").doc(messageId).delete();
        console.log("Message deleted successfully");
    } catch (error) {
        console.error("Error deleting message:", error);
    }
}
    </script>
</body>

</html>
